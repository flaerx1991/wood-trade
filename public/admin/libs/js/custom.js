let dragAndDrop=document.querySelector(".drag-and-drop"),uploadsImages=[];const fileTypes=["image/png","image/jpeg","image/svg","image/svg+xml","image/webp"];function openImageEditForm(e,a){let t=$(".wt-admin-form-wrap");$(".form-wrap textarea").val(""),$(".form-wrap .lang-buttons").attr("data-lang",a);let n=$(".wt-admin-form-wrap .form-wrap .form-input-image-name");n.attr("placeholder",e),n.val(""),$(".wt-admin-form-wrap .lang-button").removeClass("lang-button-selected");let o=$(".wt-admin-form-wrap .lang-button-"+a);o.addClass("lang-button-selected"),$.ajax({url:"/admin/get-images-meta",type:"post",cache:!1,data:{lang:a,name:e},success:function(e){0!=e&&(e=JSON.parse(e),$(".textarea-wrap .textarea-alt").val(e.alt),$(".textarea-wrap .textarea-title").val(e.title),$(".textarea-wrap .textarea-description").val(e.description))},error:function(e,a,t){console.log(a,t)}}),"block"!=t.css("display")&&t.fadeToggle()}function closeImageEditForm(){let e=$(".wt-admin-form-wrap");$(".wt-admin-form-wrap .form-wrap .form-input-image-name").val(""),"block"==e.css("display")&&e.fadeToggle()}function changeFormLang(e){$(".wt-admin-form-wrap .lang-button").removeClass("lang-button-selected");var a=$(".wt-admin-form-wrap .form-wrap .form-input-image-name").attr("placeholder");console.lo,openImageEditForm(a,e)}function inputSpaceLess(e){return e.split(" ").join("")}function changeImageName(){let e=$(".wt-admin-form-wrap .form-wrap .form-input-image-name").val();var a=$(".wt-admin-form-wrap .form-wrap .form-input-image-name").attr("placeholder");let t=$(".form-wrap .lang-buttons").attr("data-lang"),n=new FormData;n.append("oldName",a),n.append("name",e),0<e.trim().length?$.ajax({url:"/admin/change-images-name",type:"post",contentType:!1,processData:!1,cache:!1,data:n,success:function(e){console.log(e),0!=e&&openImageEditForm(e,t)},error:function(e,a,t){console.log(a,t)}}):console.log("empty name")}function setImageMeta(){var e={name:$(".wt-admin-form-wrap .form-wrap .form-input-image-name").attr("placeholder"),lang:$(".form-wrap .lang-buttons").attr("data-lang"),alt:$(".textarea-wrap .textarea-alt").val(),title:$(".textarea-wrap .textarea-title").val(),description:$(".textarea-wrap .textarea-description").val()};$.ajax({url:"/admin/set-images-meta",type:"post",cache:!1,data:e,success:function(e){console.log(e)},error:function(e,a,t){console.log(a,t)}})}function deleteImage(){var e=$(".wt-admin-form-wrap .form-wrap .form-input-image-name").attr("placeholder");let a=document.querySelector('[data-name="'+e+'"]');$.ajax({url:"/admin/delete-image",type:"post",cache:!1,data:{name:e},success:function(e){console.log(e)},error:function(e,a,t){console.log(a,t)}}),a.remove(),closeImageEditForm()}function uploadImages(){let e=document.querySelector(".images-message-block .message"),a=$(".images-message-block .message");"block"==a.css("display")&&a.slideToggle(100),e.className="message";let t=new FormData;if(0<uploadsImages.length){for(var n in uploadsImages)t.append(n,uploadsImages[n]);$.ajax({url:"/admin/upload-images",type:"post",contentType:!1,processData:!1,cache:!1,data:t,success:function(e){1==e&&(window.location.href="/admin/images")},error:function(e,a,t){console.log(a,t)}})}else e.innerHTML="Не добавлено ни единого изображения",e.className="message bad",setTimeout(function(){a.slideToggle("slow")},400)}function openImageAddingDropzone(){let e=$(".wt-admin-product-dragndrop-wrap"),a=$(".wt-admin-product-dragndrop-wrap .drag-and-drop");a.empty(),"block"!=e.css("display")&&e.fadeToggle()}function closeImageAddingDropzone(){let e=$(".wt-admin-product-dragndrop-wrap");$(".wt-admin-product-dragndrop-wrap .drag-and-drop");"block"==e.css("display")&&e.fadeToggle()}function uploadImagesOnProduct(e,o){let a=document.querySelector(".images-message-block .message"),t=$(".images-message-block .message");"block"==t.css("display")&&t.slideToggle(100),a.className="message";let n=new FormData;if(n.append("p_key",e),0<uploadsImages.length){for(var r in uploadsImages)n.append(r,uploadsImages[r]);$.ajax({url:"/admin/upload-images-to-product",type:"post",contentType:!1,processData:!1,cache:!1,data:n,success:function(e){e=JSON.parse(e);let a=document.querySelector(".wt-admin-img-form .img-grid");closeImageAddingDropzone();for(var[t,n]of Object.entries(e))a.innerHTML+="<div class='item' data-name='"+t+"' data-path='"+n+"'> <div class='edit-button' onclick=\"openImageEditForm('"+t+"', '"+o+"')\"></div> <div class='delete-item' onclick=\"deleteImageItem('"+t+"')\"></div> <div class='move-buttons'> <div class='move-buttons-left' onclick=\"moveItemLeftRight('left', '"+t+"')\"></div> <div class='move-buttons-right' onclick=\"moveItemLeftRight('right', '"+t+"')\"></div> </div> <div class='img-item' style='background-image: url("+n+");'></div> <p class='item-text'>"+t+"</p> </div>"},error:function(e,a,t){console.log(a,t)}})}else a.innerHTML="Не добавлено ни единого изображения",a.className="message bad",setTimeout(function(){t.slideToggle("slow")},400)}function deleteImageItem(e){let a=document.querySelector('[data-name="'+e+'"]');a.remove()}function moveItemLeftRight(e,a){a=document.querySelector('[data-name="'+a+'"]');var t=document.querySelectorAll(".img-grid .item");let n=0;for(let e=0;e<t.length;e++)a==t[e]&&(n=e);switch(e){case"left":0!=n&&a.parentNode.insertBefore(a,t[n-1]);break;case"right":n!=t.length-1&&a.parentNode.insertBefore(t[n+1],a)}}function clearMeta(e){let t={};return $.each(e,function(e,a){t[a.name]=a.value}),JSON.stringify(Object.fromEntries(Object.entries(t).filter(([,e])=>""!=e)),null)}function uploadImagesPost(){let e=!1,a=new FormData;for(var t in uploadsImages)a.append(t,uploadsImages[t]);var n=clearMeta($("#product_meta :input").serializeArray()),o=document.getElementsByName("name")[0].value,r=document.getElementsByName("price")[0].value,l=document.getElementsByName("properties")[0].value,m=document.getElementsByName("more_info")[0].value,d=document.getElementsByName("description")[0].value,s=document.getElementsByName("category")[0],s=s.options[s.selectedIndex].value;a.append("name",o),a.append("meta",n),a.append("price",r),a.append("properties",l),a.append("more_info",m),a.append("description",d),a.append("category",s),""!==o&&""!==l&&""!==s&&""!==r&&""!==d&&""!==m&&0<uploadsImages.length&&(e=!0),e&&$.ajax({url:"/admin/upload-product",type:"post",contentType:!1,processData:!1,cache:!1,data:a,success:function(e){console.log(e),window.location.href="/admin/create-product"},error:function(e,a,t){console.log(a,t)}})}function updateImagesPost(e,a){let t=!1,n=new FormData,o=document.querySelectorAll(".img-grid .item"),r="";for(let e=0;e<o.length;e++)r+=o[e].getAttribute("data-name")+" ";var l=clearMeta($("#product_meta :input").serializeArray()),m=document.getElementsByName("name")[0].value,d=document.getElementsByName("price")[0].value,s=document.getElementsByName("properties")[0].value,i=document.getElementsByName("more_info")[0].value,c=document.getElementsByName("description")[0].value,p=document.getElementsByName("categorySelect")[0],p=p.options[p.selectedIndex].value;n.append("name",m),n.append("meta",l),n.append("price",d),n.append("properties",s),n.append("more_info",i),n.append("description",c),n.append("category",p),n.append("images",r),""!==m&&""!==s&&""!==p&&""!==d&&""!==c&&""!==i&&""!==r&&(t=!0),t&&$.ajax({url:"/admin/update-product/"+e+"/"+a,type:"post",contentType:!1,processData:!1,cache:!1,data:n,success:function(e){console.log(e),window.location.href="/admin/products"},error:function(e,a,t){}})}function selectImageForPage(e){let a=$(".wt-admin-img-form-on-page");a.attr("data-name",e),"block"!=a.css("display")&&a.fadeToggle()}function closeImgFogmOnPage(){let e=$(".wt-admin-img-form-on-page");e.attr("data-name",""),"block"==e.css("display")&&e.fadeToggle()}function addImgToPageField(e){let a=$(".wt-admin-img-form-on-page");var t=a.attr("data-name"),n=e.getAttribute("data-name"),e=e.getAttribute("data-path");let o=$("#image_field_"+t+" p"),r=$("#image_field_"+t+" img"),l=$("#image_field_"+t+" input");o.text(n),l.val(n),r.attr("src",e),closeImgFogmOnPage()}dragAndDrop.addEventListener("dragenter",e=>{e.preventDefault()}),dragAndDrop.addEventListener("dragleave",e=>{e.preventDefault()}),dragAndDrop.addEventListener("dragover",e=>{e.preventDefault()}),dragAndDrop.addEventListener("drop",e=>{e.preventDefault();$("#inputImg");var t,n=e.dataTransfer.files;dragAndDrop.classList.add("drag-and-drop-active");for(let a=0;a<n.length;a++)if(fileTypes.includes(n[a].type)){alreadyIn=!1;for(let e=0;e<uploadsImages.length;e++)uploadsImages[e].name==n[a].name&&(alreadyIn=!0);alreadyIn?alert("Файл с таким же именем уже добален ( "+n[a].name+" )"):(uploadsImages.push(n[a]),t=URL.createObjectURL(n[a]),$(".drag-and-drop").append('<div class="drag-and-drop-img" style="background-image: url('+t+');" href="'+n[a].name+'"></div>'))}else alert("Файл "+n[a].name+" не подходящего формата")}),$(".drag-and-drop").on("click","div.drag-and-drop-img",function(e){e.preventDefault();var a=$(this).attr("href");for(let e=0;e<uploadsImages.length;e++)a==uploadsImages[e].name&&uploadsImages.splice(e,1);$(this).remove()});
//# sourceMappingURL=custom.js.map
